<html>
%= stylesheet '/css/calendar_weather.css'
%= stylesheet '/css/weather-icons.min.css'
% my $decorator = sub { shift };        # returns input as-is
% $decorator = sub { uc(shift) };       # UPPERCASE
%# $decorator = sub { ucfirst(shift) }; # Uppercase
%# $decorator = sub { Text::Unidecode::unidecode(uc(shift)) }; # UPPERCASE with accents removed

<body>
    <div id="visible-area">
        <div class="day-number-big" style="color: red">
            <%= sprintf("%02d", $date->day) %>
        </div>

        <div class="date-row top-date-row">
            <div>
                <%= $decorator->($name_day_details->{dayNumber}) %>. <%= $decorator->($name_day_details->{month}->{genitive}) %>
            </div>
            <div>
                <%= $decorator->($name_day_details->{name}) %>
            </div>
        </div>

        <div class="horizontal-separator" style="top: 45"></div>

        <!--
        <div class="horizontal-separator" style="top: 220"></div>
        <div class="date-row bottom-date-row">
            <div>
                %# <%= $decorator->($name_day_details->{dayNumber} . '. ' . $name_day_details->{monthNumber} . '.') %>
            </div>
            <div>
                %# <%= $decorator->($name_day_details->{dayInWeek}) %>
            </div>
        </div>
        -->

        <div class="horizontal-separator" style="top: 220"></div>


        
        <div class="weather-forecast-container-grid" style="top: 260">


        % use DateTime::Event::Sunrise;
        % my $sunrise = DateTime::Event::Sunrise->new(longitude => $app->get_config('lon'), latitude => $app->get_config('lat'));

        %# See https://openweathermap.org/forecast5#fields_JSON
        % my $cnt = 0;
        % foreach my $item (@{ $forecast->{list} }) {
            % $cnt++;
            % last if $cnt > 5;

            % my $rain = 0+($item->{rain}->{'3h'} // 0); # mm in 3 hours
            % my $snow = 0+($item->{snow}->{'3h'} // 0); # mm in 3 hours
            % my $total_precip = $rain + $snow;

            % my $dt = DateTime->from_epoch(epoch => $item->{dt}, time_zone => 'UTC');
            % my $now = DateTime->now;
            % my $day_or_night = $sunrise->sunrise_sunset_span($dt)->contains($dt) ? 'day' : 'night';

            % my $day_description = '';
            % if ($dt->ymd eq $now->ymd) {
            %    $day_description = 'dnes';
            % } elsif ($dt->ymd eq $now->clone->add(days => 1)->ymd) {
            %    $day_description = 'zÃ­tra';
            % } else {
            %    $day_description = $dt->day_name;
            % }

            <div class="weather-item weather-item-<%= $day_or_night %> weather-single-day-container-grid">
                <div>
                    <%= $day_description %>
                    <br>
                    <%= sprintf("%02d:00", $dt->hour) %>
                </div>
                <div>
                    % foreach my $condition (@{ $item->{weather} }) {
                        <div style="font-weight: bold"><%= $condition->{description} %></div>
                    % }
                </div>
                <div>
                    % foreach my $condition (@{ $item->{weather} }) {
                        %# https://erikflowers.github.io/weather-icons/api-list.html
                        <i class="wi wi-owm-<%= $day_or_night %>-<%= $condition->{id} %>" style="font-size: 2rem; margin-top: 0.5rem; margin-left: 0.5rem"></i>
                    % }
                </div>
                <div style="text-align: center">
                    <div>
                        <%= sprintf('%.1f', $item->{main}->{temp_min}) %> &deg;C
                    </div>
                    <div style="line-height: 40%">
                        - 
                    </div>
                    <div>
                        <%= sprintf('%.1f', $item->{main}->{temp_max}) %> &deg;C
                    </div>
                </div>
                <div style="text-align: center">
                    % if ($rain > 0) {
                        <div>
                            <i class="wi wi-rain" style="font-size: 1rem"></i>
                        </div>
                        <div style="margin-top: 0.2rem">
                            <%= sprintf('%.1f', $rain) %> mm
                        </div>
                    % }
                    % if ($snow > 0) {
                        <div>
                            <i class="wi wi-snow" style="font-size: 1rem"></i>
                        </div>
                        <div style="margin-top: 0.2rem">
                            <%= sprintf('%.1f', $snow) %> mm
                        </div>
                    % }
                </div>
            </div>
        % }
        </div>

        <div class="bottom-signature">
            Data from: <%= DateTime->from_epoch(epoch => $current_weather->{dt})->set_time_zone($app->get_config('timezone'))->strftime('%c') %>
        </div>
    </div>
</body>

</html>