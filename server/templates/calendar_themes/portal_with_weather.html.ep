<html>
%= stylesheet '/css/calendar_weather.css'
%= stylesheet '/css/weather-icons.min.css'
% my $decorator = sub { shift };        # returns input as-is
% $decorator = sub { uc(shift) };       # UPPERCASE
%# $decorator = sub { ucfirst(shift) }; # Uppercase
%# $decorator = sub { Text::Unidecode::unidecode(uc(shift)) }; # UPPERCASE with accents removed

<body>
    <div id="spacer">
        <div class="day-of-week-block">
            <div class="dow-number-and-name">
                <div>
                    <%= $decorator->($name_day_details->{dayNumber} . '. ' . $name_day_details->{month}->{genitive}) %>
                </div>
                <div>
                    <%= $decorator->($date->day_name) %>
                </div>
            </div>
            <div class="separator"></div>
        </div>

        <div class="name-day-header">
            <%= $decorator->($name_day_details->{name}) %>
        </div>

        <div class="day-number-big">
            <%= sprintf("%02d", $date->day) %>
        </div>

        
        <div class="weather-container-grid">
        %# See https://openweathermap.org/forecast5#fields_JSON
        % my $cnt = 0;
        % foreach my $item (@{ $forecast->{list} }) {
            % $cnt++;
            % last if $cnt > 5;

            % my $rain = 0+($item->{rain}->{'3h'} // 0); # mm in 3 hours
            % my $snow = 0+($item->{snow}->{'3h'} // 0); # mm in 3 hours
            % my $total_precip = $rain + $snow;
            % my $dt = DateTime->from_epoch(epoch => $item->{dt},, time_zone => 'UTC');
            % my $now = DateTime->now;

            %# Current! sunrise/sunset data aren't available in the forecast
            % my $day_or_night = ($item->{dt} < $current_weather->{sys}->{sunrise} || $item->{dt} > $current_weather->{sys}->{sunset}) ? 'night' : 'day';

            % my $day_description = '';
            % if ($dt->ymd eq $now->ymd) {
            %    $day_description = 'dnes';
            % } elsif ($dt->ymd eq $now->clone->add(days => 1)->ymd) {
            %    $day_description = 'zÃ­tra';
            % } else {
            %    $day_description = $dt->day_name;
            % }

            <div class="weather-item">
                <div>
                    <%= $day_description %>
                </div>
                <div>
                    <%= sprintf("%02d:00", $dt->hour) %>
                </div>
                <div>
                    % foreach my $condition (@{ $item->{weather} }) {
                        %# https://erikflowers.github.io/weather-icons/api-list.html
                        <span style="font-weight: bold"><%= $condition->{description} %></span>
                        <br>
                        <i class="wi wi-owm-<%= $day_or_night %>-<%= $condition->{id} %>" style="font-size: 2rem"></i>
                    % }
                </div>
                <div>
                    <%= sprintf('%.1f', $item->{main}->{temp_min}) %> &deg;C 
                    <br>
                    - 
                    <br>
                    <%= sprintf('%.1f', $item->{main}->{temp_max}) %> &deg;C
                </div>
                <div>
                    <%= sprintf('%.1f', $total_precip) %> mm
                </div>
            </div>
        % }
        </div>

        <div style="font-size: 0.7rem">
            Data from: <%= DateTime->from_epoch(epoch => $current_weather->{dt})->set_time_zone($app->get_config('timezone'))->strftime('%c') %>
        </div>
    </div>
</body>

</html>